

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>triplets.rdf_parser &mdash; triplets 0.0.17 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=63b572e7"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            triplets
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../triplets.rdf_parser.html">triplets.rdf_parser module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../triplets.cgmes_tools.html">triplets.cgmes_tools module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../triplets.rdfs_tools.html">triplets.rdfs_tools package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">triplets</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">triplets.rdf_parser</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for triplets.rdf_parser</h1><div class="highlight"><pre>
<span></span><span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Name:        RDF parser</span>
<span class="c1"># Purpose:     Loads RDF XMLs from zip and xml files to pandas DataFrame in a triplestore manner</span>
<span class="c1">#</span>
<span class="c1"># Author:      kristjan.vilgo</span>
<span class="c1">#</span>
<span class="c1"># Created:     13.12.2018</span>
<span class="c1"># Copyright:   (c) kristjan.vilgo 2018</span>
<span class="c1"># Licence:     MIT</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">StrEnum</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">lxml</span><span class="w"> </span><span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lxml.builder</span><span class="w"> </span><span class="kn">import</span> <span class="n">ElementMaker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lxml.etree</span><span class="w"> </span><span class="kn">import</span> <span class="n">QName</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">ProcessPoolExecutor</span>

<span class="c1"># from collections import deque</span>

<span class="c1"># from multiprocessing import Pool - TODO add parallel loading for import ALL DASK, SPARK, MODIN, VAEX</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># pandas.set_option(&quot;display.height&quot;, 1000)</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.width&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>


<span class="c1"># pandas.set_option(&#39;display.max_colwidth&#39;, -1)</span>

<span class="c1"># FUNCTIONS - go down for sample code</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_print_duration</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print duration between now and start time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        Description of the timed operation to include in the log message.</span>
<span class="sd">    start_time : datetime.datetime</span>
<span class="sd">        Start time of the operation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - duration (timedelta): Time elapsed since start_time.</span>
<span class="sd">        - end_time (datetime.datetime): Current time when the function is called.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; start = datetime.datetime.now()</span>
<span class="sd">    &gt;&gt;&gt; duration, end = _print_duration(&quot;Operation completed&quot;, start)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">duration</span><span class="p">,</span> <span class="n">end_time</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_remove_prefix</span><span class="p">(</span><span class="n">original_string</span><span class="p">,</span> <span class="n">prefix_string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a specified prefix from a string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    original_string : str</span>
<span class="sd">        The input string to process.</span>
<span class="sd">    prefix_string : str</span>
<span class="sd">        The prefix to remove from the input string.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The input string with the prefix removed if present; otherwise, the original string.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; _remove_prefix(&quot;urn:uuid:1234&quot;, &quot;urn:uuid:&quot;)</span>
<span class="sd">    &#39;1234&#39;</span>
<span class="sd">    &gt;&gt;&gt; _remove_prefix(&quot;abc&quot;, &quot;xyz&quot;)</span>
<span class="sd">    &#39;abc&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefix_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix_string</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">original_string</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">prefix_length</span><span class="p">]</span> <span class="o">==</span> <span class="n">prefix_string</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">original_string</span><span class="p">[</span><span class="n">prefix_length</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">original_string</span>


<div class="viewcode-block" id="get_namespace_map">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.get_namespace_map">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_namespace_map</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract namespace prefix-to-URI mapping and optional xml:base from a triplet dataset.</span>

<span class="sd">    This function searches for a `NamespaceMap` object (identified by ``KEY=&#39;Type&#39;`` and ``VALUE=&#39;NamespaceMap&#39;``)</span>
<span class="sd">    within the dataset. It then collects all key-value pairs under that instance where:</span>
<span class="sd">    - ``KEY`` is the namespace prefix (e.g., &quot;cim&quot;, &quot;rdf&quot;)</span>
<span class="sd">    - ``VALUE`` is the full URI (e.g., &quot;http://iec.ch/TC57/2013/CIM-schema-cim16#&quot;)</span>

<span class="sd">    Special keys:</span>
<span class="sd">    - ``xml_base``: Extracted separately if present (used as base URI in RDF).</span>
<span class="sd">    - ``Type``: Automatically excluded.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset with columns [&#39;INSTANCE_ID&#39;, &#39;ID&#39;, &#39;KEY&#39;, &#39;VALUE&#39;].</span>
<span class="sd">        Must contain a `NamespaceMap` instance for successful extraction.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    namespace_map : dict</span>
<span class="sd">        Mapping of namespace prefixes to URIs (e.g., ``{&quot;cim&quot;: &quot;...&quot;, &quot;rdf&quot;: &quot;...&quot;}``).</span>
<span class="sd">        **Empty dict** if no `NamespaceMap` is found.</span>
<span class="sd">    xml_base : str</span>
<span class="sd">        Value of ``xml_base`` if defined within the `NamespaceMap`; otherwise ``empty str``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; ns_map, base = get_namespace_map(triplet_data)</span>
<span class="sd">    &gt;&gt;&gt; print(ns_map)</span>
<span class="sd">    {&#39;cim&#39;: &#39;http://iec.ch/TC57/2013/CIM-schema-cim16#&#39;, &#39;rdf&#39;: &#39;http://www.w3.org/1999/02/22-rdf-syntax-ns#&#39;}</span>
<span class="sd">    &gt;&gt;&gt; print(base)</span>
<span class="sd">    &#39;http://example.com/base/&#39;</span>

<span class="sd">    &gt;&gt;&gt; ns_map, base = get_namespace_map(empty_data)</span>
<span class="sd">    &gt;&gt;&gt; print(ns_map, base)</span>
<span class="sd">    {} &quot;&quot;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The function is **idempotent** and safe to call on any dataset.</span>
<span class="sd">    - Uses inner merge on ``ID`` to scope entries to the correct `NamespaceMap` instance.</span>
<span class="sd">    - Always returns a tuple of length 2: ``(dict, str)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">namespace_map_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;Type&#39; and VALUE == &#39;NamespaceMap&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">namespace_map_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{},</span> <span class="s2">&quot;&quot;</span>

    <span class="n">namespace_map</span> <span class="o">=</span> <span class="n">namespace_map_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;KEY&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">namespace_map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xml_base</span> <span class="o">=</span> <span class="n">namespace_map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xml_base&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">namespace_map</span><span class="p">,</span> <span class="n">xml_base</span></div>



<div class="viewcode-block" id="clean_ID">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.clean_ID">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clean_ID</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove common CIM ID prefixes from a string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ID : str</span>
<span class="sd">        The input ID string to clean.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The ID with prefixes (&#39;urn:uuid:&#39;, &#39;#_&#39;, &#39;_&#39;) removed from the start.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Sequentially removes &#39;urn:uuid:&#39;, &#39;#_&#39;, and &#39;_&#39; prefixes using removeprefix.</span>
<span class="sd">    - TODO: Verify if these characters are absent in UUIDs to ensure safe removal.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; clean_ID(&quot;urn:uuid:1234&quot;)</span>
<span class="sd">    &#39;1234&#39;</span>
<span class="sd">    &gt;&gt;&gt; clean_ID(&quot;#_abc&quot;)</span>
<span class="sd">    &#39;abc&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - a lot of replacements have been done using replace function, but is it valid that these characters are not present in UUID-s? is replace once sufficent?</span>

    <span class="c1"># replace_count = 1 # Remove only once the ID prefix string, otherwise we risk of removing characters from within ID</span>
    <span class="c1"># clean_ID      = ID.replace(&quot;urn:uuid:&quot;, &quot;&quot;, replace_count).replace(&quot;#_&quot;, &quot;&quot;, replace_count).replace(&quot;_&quot;, &quot;&quot;, replace_count)</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">_remove_prefix</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;urn:uuid:&quot;</span><span class="p">)</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">_remove_prefix</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;#_&quot;</span><span class="p">)</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">_remove_prefix</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ID</span></div>



<div class="viewcode-block" id="load_RDF_objects_from_XML">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.load_RDF_objects_from_XML">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_RDF_objects_from_XML</span><span class="p">(</span><span class="n">path_or_fileobject</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse an XML file and return an iterator of RDF objects with instance ID and namespace map.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_or_fileobject : str or file-like object</span>
<span class="sd">        Path to the XML file or a file-like object containing RDF XML data.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        If True, log timing information for debugging (default is False).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - RDF_objects (iterator): Iterator over RDF objects in the XML.</span>
<span class="sd">        - instance_id (str): Unique UUID for the loaded instance.</span>
<span class="sd">        - namespace_map (dict): Dictionary of namespace prefixes and URIs.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; rdf_objects, instance_id, ns_map = load_RDF_objects_from_XML(&quot;file.xml&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># START TIMER</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># LOAD XML</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">remove_comments</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collect_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">remove_blank_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parsed_xml</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">path_or_fileobject</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">parser</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>  <span class="c1"># TODO - add iterparse for Python3</span>

    <span class="c1"># Get namespace map</span>
    <span class="n">namesapce_map</span> <span class="o">=</span> <span class="n">parsed_xml</span><span class="o">.</span><span class="n">nsmap</span>
    <span class="n">namesapce_map</span><span class="p">[</span><span class="s2">&quot;xml_base&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parsed_xml</span><span class="o">.</span><span class="n">base</span>

    <span class="c1"># Get unique ID for loaded instance</span>
    <span class="c1"># instance_id = clean_ID(parsed_xml.find(&quot;./&quot;).attrib.values()[0]) # Lets asume that the first RDF element describes the whole document - TODO replace it with hash of whole XML</span>
    <span class="n">instance_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>  <span class="c1"># Guarantees unique ID for each loaded instance of data, in erronous data it happens that same UUID is used for multiple files</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;XML loaded to tree object&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="c1"># EXTRACT RDF OBJECTS</span>
    <span class="n">RDF_objects</span> <span class="o">=</span> <span class="n">parsed_xml</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;All children put to a generator&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">RDF_objects</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">,</span> <span class="n">namesapce_map</span></div>



<div class="viewcode-block" id="find_all_xml">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.find_all_xml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_all_xml</span><span class="p">(</span><span class="n">list_of_paths_to_zip_globalzip_xml</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract XML files from a list of paths or ZIP archives.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    list_of_paths_to_zip_globalzip_xml : list</span>
<span class="sd">        List of paths to XML files, ZIP archives, or file-like objects.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        If True, log file processing details for debugging (default is False).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of file-like objects for XML files found in the input paths or ZIPs.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Supports XML, RDF, and ZIP files; other file types are logged as unsupported.</span>
<span class="sd">    - TODO: Add support for random folders.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; xml_files = find_all_xml([&quot;data.zip&quot;, &quot;file.xml&quot;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xml_files_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">zip_files_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># TODO - add support random folders as well</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_of_paths_to_zip_globalzip_xml</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>

        <span class="n">item_lower</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;.xml&quot;</span> <span class="ow">in</span> <span class="n">item_lower</span> <span class="ow">or</span> <span class="s2">&quot;.rdf&quot;</span> <span class="ow">in</span> <span class="n">item_lower</span><span class="p">:</span>
            <span class="n">xml_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Added: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="k">elif</span> <span class="s2">&quot;.zip&quot;</span> <span class="ow">in</span> <span class="n">item_lower</span><span class="p">:</span>
            <span class="n">zip_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Added for further processing: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not supported file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">zip_file_path</span> <span class="ow">in</span> <span class="n">zip_files_list</span><span class="p">:</span>

        <span class="n">zip_container</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_file_path</span><span class="p">)</span>
        <span class="n">zipped_files</span> <span class="o">=</span> <span class="n">zip_container</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">zipped_file</span> <span class="ow">in</span> <span class="n">zipped_files</span><span class="p">:</span>

            <span class="n">zipped_file_lower</span> <span class="o">=</span> <span class="n">zipped_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">if</span> <span class="s2">&quot;.xml&quot;</span> <span class="ow">in</span> <span class="n">zipped_file_lower</span> <span class="ow">or</span> <span class="s2">&quot;.rdf&quot;</span> <span class="ow">in</span> <span class="n">zipped_file_lower</span><span class="p">:</span>
                <span class="n">file_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">zip_container</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">zipped_file</span><span class="p">))</span>
                <span class="n">file_object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">zipped_file</span>
                <span class="n">xml_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_object</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Added: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zipped_file</span><span class="p">))</span>

            <span class="k">elif</span> <span class="s2">&quot;.zip&quot;</span> <span class="ow">in</span> <span class="n">zipped_file_lower</span><span class="p">:</span>
                <span class="n">zip_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zip_container</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">zipped_file</span><span class="p">)))</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Added for further processing: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zipped_file</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not supported file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zipped_file</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">xml_files_list</span></div>



<div class="viewcode-block" id="load_RDF_to_list">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.load_RDF_to_list">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_RDF_to_list</span><span class="p">(</span><span class="n">path_or_fileobject</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep_ns</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single RDF XML file into a triplestore list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_or_fileobject : str or file-like object</span>
<span class="sd">        Path to the XML file or a file-like object containing RDF XML data.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        If True, log timing information for debugging (default is False).</span>
<span class="sd">    keep_ns : bool, optional</span>
<span class="sd">        If True, retain namespace information in the output (default is False, unused).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of tuples in the format (ID, KEY, VALUE, INSTANCE_ID) representing the triplestore.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; triples = load_RDF_to_list(&quot;file.xml&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">path_or_fileobject</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_or_fileobject</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">path_or_fileobject</span><span class="o">.</span><span class="n">name</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">RDF_objects</span><span class="p">,</span> <span class="n">INSTANCE_ID</span><span class="p">,</span> <span class="n">namespace_map</span> <span class="o">=</span> <span class="n">load_RDF_objects_from_XML</span><span class="p">(</span><span class="n">path_or_fileobject</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="n">RDF_NS</span> <span class="o">=</span> <span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
    <span class="n">RDF_ID</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">RDF_NS</span><span class="si">}</span><span class="se">}}</span><span class="s2">ID&quot;</span>
    <span class="n">RDF_ABOUT</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">RDF_NS</span><span class="si">}</span><span class="se">}}</span><span class="s2">about&quot;</span>
    <span class="n">RDF_RESOURCE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">RDF_NS</span><span class="si">}</span><span class="se">}}</span><span class="s2">resource&quot;</span>

    <span class="c1"># Generate list for RDF data and store the original filename under rdf:label in dcat:Distribution object</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">ID_NSMAP</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">data_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Distribution&quot;</span><span class="p">,</span> <span class="n">INSTANCE_ID</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">INSTANCE_ID</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ID_NSMAP</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;NamespaceMap&quot;</span><span class="p">,</span> <span class="n">INSTANCE_ID</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">namespace_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ID_NSMAP</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">INSTANCE_ID</span><span class="p">))</span>

    <span class="c1"># Reuse variables to avoid creating new ones in loops</span>
    <span class="n">KEY</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">VALUE</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">KEY_NS</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">VALUE_NS</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">RDF_object</span> <span class="ow">in</span> <span class="n">RDF_objects</span><span class="p">:</span>
        <span class="n">ID</span> <span class="o">=</span> <span class="n">clean_ID</span><span class="p">(</span><span class="n">RDF_object</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RDF_ID</span><span class="p">)</span> <span class="ow">or</span> <span class="n">RDF_object</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RDF_ABOUT</span><span class="p">))</span>
        <span class="n">KEY</span> <span class="o">=</span> <span class="s2">&quot;Type&quot;</span>
        <span class="n">KEY_NS</span> <span class="o">=</span> <span class="n">RDF_NS</span>
        <span class="c1"># Use partition instead of split, with fallback for no &quot;}&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">RDF_object</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
        <span class="n">VALUE_NS</span><span class="p">,</span> <span class="n">VALUE</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ID</span><span class="p">,</span> <span class="n">KEY</span><span class="p">,</span> <span class="n">VALUE</span><span class="p">,</span> <span class="n">INSTANCE_ID</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">RDF_object</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">():</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
            <span class="n">KEY_NS</span><span class="p">,</span> <span class="n">KEY</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">VALUE</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>
            <span class="n">VALUE_NS</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">VALUE</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>

                <span class="c1"># TODO - NB CIM ID specific, to be skipped for generic parsing</span>
                <span class="n">VALUE</span> <span class="o">=</span> <span class="n">clean_ID</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RDF_RESOURCE</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

                <span class="c1"># TODO - NB CIM enumeration specific</span>
                <span class="k">if</span> <span class="n">VALUE</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
                    <span class="n">VALUE</span> <span class="o">=</span> <span class="n">VALUE</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ID</span><span class="p">,</span> <span class="n">KEY</span><span class="p">,</span> <span class="n">VALUE</span><span class="p">,</span> <span class="n">INSTANCE_ID</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;All values put to data list&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data_list</span></div>



<div class="viewcode-block" id="load_RDF_to_dataframe">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.load_RDF_to_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_RDF_to_dataframe</span><span class="p">(</span><span class="n">path_or_fileobject</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single RDF XML file into a Pandas DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_or_fileobject : str or file-like object</span>
<span class="sd">        Path to the XML file or a file-like object containing RDF XML data.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        If True, log timing information for debugging (default is False).</span>
<span class="sd">    data_type : str, optional</span>
<span class="sd">        Data type for DataFrame columns (default is &#39;string&#39;).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        DataFrame with columns [&#39;ID&#39;, &#39;KEY&#39;, &#39;VALUE&#39;, &#39;INSTANCE_ID&#39;] representing the triplestore.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; df = load_RDF_to_dataframe(&quot;file.xml&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_list</span> <span class="o">=</span> <span class="n">load_RDF_to_list</span><span class="p">(</span><span class="n">path_or_fileobject</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">,</span> <span class="s2">&quot;INSTANCE_ID&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;List of data loaded to DataFrame&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>



<div class="viewcode-block" id="load_all_to_dataframe">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.load_all_to_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_all_to_dataframe</span><span class="p">(</span><span class="n">list_of_paths_to_zip_globalzip_xml</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse multiple RDF XML files or ZIP archives into a single Pandas DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    list_of_paths_to_zip_globalzip_xml : list or str</span>
<span class="sd">        List of paths to XML files, ZIP archives, or a single path.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        If True, log timing information for debugging (default is False).</span>
<span class="sd">    data_type : str, optional</span>
<span class="sd">        Data type for DataFrame columns (default is &#39;string&#39;).</span>
<span class="sd">    max_workers : int, optional</span>
<span class="sd">        Number of worker threads for parallel processing (default is None).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        DataFrame with columns [&#39;ID&#39;, &#39;KEY&#39;, &#39;VALUE&#39;, &#39;INSTANCE_ID&#39;] containing all parsed data.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; df = load_all_to_dataframe([&quot;data.zip&quot;, &quot;file.xml&quot;], max_workers=4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO - Support folder</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">process_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># List is expected, but if no list lets assume it is single element list</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">list_of_paths_to_zip_globalzip_xml</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">list_of_paths_to_zip_globalzip_xml</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_of_paths_to_zip_globalzip_xml</span><span class="p">]</span>

    <span class="n">list_of_xmls</span> <span class="o">=</span> <span class="n">find_all_xml</span><span class="p">(</span><span class="n">list_of_paths_to_zip_globalzip_xml</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

    <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">max_workers</span><span class="p">:</span>

        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># Submit each task individually</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">load_RDF_to_list</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="k">for</span> <span class="n">xml</span> <span class="ow">in</span> <span class="n">list_of_xmls</span><span class="p">]</span>
            <span class="c1"># Collect results as they complete</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">]</span>
            <span class="n">data_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">xml</span> <span class="ow">in</span> <span class="n">list_of_xmls</span><span class="p">:</span>
            <span class="n">data_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">load_RDF_to_list</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">debug</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">,</span> <span class="s2">&quot;INSTANCE_ID&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;Data list loaded to DataFrame&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;All loaded in &quot;</span><span class="p">,</span> <span class="n">process_start</span><span class="p">)</span>
        <span class="c1"># logger.debug(data.info())</span>

    <span class="k">return</span> <span class="n">data</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">read_RDF</span> <span class="o">=</span> <span class="n">load_all_to_dataframe</span>


<div class="viewcode-block" id="type_tableview">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.type_tableview">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">type_tableview</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">string_to_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">type_key</span><span class="o">=</span><span class="s2">&quot;Type&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a table view of all objects of a specified type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    type_name : str</span>
<span class="sd">        The type of objects to filter (e.g., &#39;ACLineSegment&#39;).</span>
<span class="sd">    string_to_number : bool, optional</span>
<span class="sd">        If True, convert columns containing numbers to numeric types (default is True).</span>
<span class="sd">    type_key : str, optional</span>
<span class="sd">        Key used to identify object types in the dataset (default is &#39;Type&#39;).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame or None</span>
<span class="sd">        Pivoted DataFrame with IDs as index and keys as columns, or None if no data is found.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; table = data.type_tableview(&quot;ACLineSegment&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get all ID-s of rows where Type == type_name</span>
    <span class="n">type_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">type_name</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">type_key</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">type_id</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No data available for </span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Filter original data by found type_id data</span>
    <span class="c1"># There can&#39;t be duplicate ID and KEY pairs for pivot, but this will lose data on full model DependantOn and other info, solution would be to use pivot table function.</span>
    <span class="n">type_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">type_id</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">]],</span> <span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">])</span>

    <span class="c1"># Convert form triplets to a table view all objects of same type</span>
    <span class="n">data_view</span> <span class="o">=</span> <span class="n">type_data</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">string_to_number</span><span class="p">:</span>
        <span class="c1"># Convert to data type to numeric in columns that contain only numbers (for easier data usage later on)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data_view</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data_view</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data_view</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">return</span> <span class="n">data_view</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">type_tableview</span> <span class="o">=</span> <span class="n">type_tableview</span>


<div class="viewcode-block" id="key_tableview">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.key_tableview">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">key_tableview</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">string_to_number</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a table view of all objects with a specified key.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    key : str</span>
<span class="sd">        The key to filter objects by (e.g., &#39;GeneratingUnit.maxOperatingP&#39;).</span>
<span class="sd">    string_to_number : bool, optional</span>
<span class="sd">        If True, convert columns containing numbers to numeric types (default is True).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame or None</span>
<span class="sd">        Pivoted DataFrame with IDs as index and keys as columns, or None if no data is found.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; table = data.key_tableview(&quot;GeneratingUnit.maxOperatingP&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get all ID-s of rows where KEY == key_name</span>
    <span class="n">key_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">key_id</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No data available for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Filter original data by found key_id data</span>
    <span class="c1"># There can&#39;t be duplicate ID and KEY pairs for pivot, but this will lose data on full model DependantOn and other info, solution would be to use pivot table function.</span>
    <span class="n">type_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">key_id</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">]],</span> <span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">])</span>

    <span class="c1"># Convert form triplets to a table view all objects of same type</span>
    <span class="n">data_view</span> <span class="o">=</span> <span class="n">type_data</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">string_to_number</span><span class="p">:</span>
        <span class="c1"># Convert to data type to numeric in columns that contain only numbers (for easier data usage later on)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data_view</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data_view</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data_view</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">return</span> <span class="n">data_view</span></div>




<div class="viewcode-block" id="id_tableview">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.id_tableview">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">id_tableview</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">string_to_number</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a tabular view of a CGMES triplet dataset filtered by ID-s.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing CGMES data.</span>
<span class="sd">    id : str or list or pandas.DataFrame</span>
<span class="sd">        DataFrame containing IDs to filter by.</span>
<span class="sd">    string_to_number : bool, optional</span>
<span class="sd">        If True, convert columns containing numbers to numeric types (default is True).</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Pivoted DataFrame with IDs as index and KEYs as columns.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; table = id_tableview(data, &#39;UUID&#39;)</span>
<span class="sd">    &gt;&gt;&gt; table = id_tableview(data, [&#39;UUID_1&#39;, &#39;UUID_2&#39;])</span>
<span class="sd">    &gt;&gt;&gt; table = id_tableview(data, pandas.DataFrame({&quot;ID&quot;:[&#39;UUID_1&#39;, &#39;UUID_2&#39;]})</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>

    <span class="n">id_data</span> <span class="o">=</span> <span class="n">filter_by_triplet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">id_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No data available for </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">data_view</span> <span class="o">=</span> <span class="n">id_data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">string_to_number</span><span class="p">:</span>
        <span class="c1"># Convert to data type to numeric in columns that contain only numbers (for easier data usage later on)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data_view</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data_view</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data_view</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">return</span> <span class="n">data_view</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">key_tableview</span> <span class="o">=</span> <span class="n">key_tableview</span>


<div class="viewcode-block" id="references_to_simple">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.references_to_simple">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">references_to_simple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a simplified table view of objects referencing a specified object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    reference : str</span>
<span class="sd">        ID of the object to find references to.</span>
<span class="sd">    columns : list, optional</span>
<span class="sd">        Columns to include in the output table (default is [&#39;Type&#39;]).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Pivoted DataFrame with IDs of referencing objects and specified columns.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; table = data.references_to_simple(&quot;99722373_VL_TN1&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">references_to</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;ID_FROM&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">])</span>

    <span class="c1"># Convert form triplets to a table view with columns - ID, Type by default</span>
    <span class="n">data_view</span> <span class="o">=</span> <span class="n">reference_data</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;ID_FROM&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">data_view</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">references_to_simple</span> <span class="o">=</span> <span class="n">references_to_simple</span>


<div class="viewcode-block" id="references_to">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.references_to">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">references_to</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve all objects pointing to a specified reference object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    reference : str</span>
<span class="sd">        ID of the reference object.</span>
<span class="sd">    levels : int, optional</span>
<span class="sd">        Number of reference levels to traverse (default is 1).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        DataFrame containing triplets of objects pointing to the reference, with a &#39;level&#39; column.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - TODO: Add the key on which the connection was made.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; refs = data.references_to(&quot;99722373_VL_TN1&quot;, levels=2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - add the key on which connection was made</span>
    <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Get the object itself</span>
    <span class="n">object_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ID == &#39;</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span>
    <span class="c1"># object_data[&quot;ID_TO&quot;] = reference</span>
    <span class="c1"># object_data[&quot;ID_FROM&quot;] = reference</span>

    <span class="c1"># Add object to processing list</span>
    <span class="n">objects_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">object_data</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">object_data</span> <span class="ow">in</span> <span class="n">objects_list</span><span class="p">:</span>

        <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># End loop if we have reached desired level</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="n">levels</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># Get column where possible reference to other objects reside</span>
        <span class="n">reference_column</span> <span class="o">=</span> <span class="n">object_data</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">]]</span>

        <span class="c1"># Filter original data VALUE-s by found references ID-s</span>
        <span class="n">reference_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reference_column</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                      <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span>
                                      <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;VALUE&quot;</span><span class="p">,</span>
                                      <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_TO&quot;</span><span class="p">,</span> <span class="s2">&quot;_FROM&quot;</span><span class="p">))[[</span><span class="s2">&quot;ID_TO&quot;</span><span class="p">,</span> <span class="s2">&quot;ID_FROM&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;ID_FROM&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">reference_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">referring_objects</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reference_data</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                             <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;ID_FROM&quot;</span><span class="p">,</span>
                                             <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">)</span>  <span class="c1"># .drop(columns=[&quot;ID_FROM&quot;])</span>

            <span class="c1"># Set object level</span>
            <span class="n">referring_objects</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span>

            <span class="c1"># Add data for future processing</span>
            <span class="n">objects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">referring_objects</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objects_list</span><span class="p">)</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">references_to</span> <span class="o">=</span> <span class="n">references_to</span>


<div class="viewcode-block" id="references_from_simple">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.references_from_simple">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">references_from_simple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a simplified table view of objects a specified object refers to.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    reference : str</span>
<span class="sd">        ID of the object to find references from.</span>
<span class="sd">    columns : list, optional</span>
<span class="sd">        Columns to include in the output table (default is [&#39;Type&#39;]).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Pivoted DataFrame with IDs of referenced objects and specified columns.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; table = data.references_from_simple(&quot;99722373_VL_TN1&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">references_from</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;ID_TO&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">])</span>

    <span class="c1"># Convert form triplets to a table view with columns - ID, Type by default</span>
    <span class="n">data_view</span> <span class="o">=</span> <span class="n">reference_data</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;ID_TO&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">data_view</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">references_from_simple</span> <span class="o">=</span> <span class="n">references_from_simple</span>


<div class="viewcode-block" id="references_from">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.references_from">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">references_from</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve all objects a specified object points to.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    reference : str</span>
<span class="sd">        ID of the reference object.</span>
<span class="sd">    levels : int, optional</span>
<span class="sd">        Number of reference levels to traverse (default is 1).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        DataFrame containing triplets of objects referenced by the input, with a &#39;level&#39; column.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - TODO: Add the key on which the connection was made.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; refs = data.references_from(&quot;99722373_VL_TN1&quot;, levels=2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - add the key on which connection was made</span>
    <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Get the object itself</span>
    <span class="n">object_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ID == &#39;</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">object_data</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span>
    <span class="c1">#object_data[&quot;ID_TO&quot;] = reference</span>
    <span class="c1">#object_data[&quot;ID_FROM&quot;] = reference</span>

    <span class="c1"># Add object to processing list</span>
    <span class="n">objects_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">object_data</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">object_data</span> <span class="ow">in</span> <span class="n">objects_list</span><span class="p">:</span>

        <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># End loop if we have reached desired level</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="n">levels</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># Get column where possible reference to other objects reside</span>
        <span class="n">reference_column</span> <span class="o">=</span> <span class="n">object_data</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]]</span>

        <span class="c1"># Filter original data ID-s by values form reference object</span>
        <span class="n">reference_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reference_column</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                      <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;VALUE&quot;</span><span class="p">,</span>
                                      <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span>
                                      <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_FROM&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;VALUE_FROM&quot;</span><span class="p">:</span> <span class="s2">&quot;ID_TO&quot;</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">reference_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>

            <span class="c1"># Set object level</span>
            <span class="n">reference_data</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span>

            <span class="c1"># Add data for future processing</span>
            <span class="n">objects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reference_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objects_list</span><span class="p">)</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">references_from</span> <span class="o">=</span> <span class="n">references_from</span>


<div class="viewcode-block" id="references_all">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.references_all">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">references_all</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find all unique references (links) in the dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        DataFrame with columns [&#39;ID_FROM&#39;, &#39;KEY&#39;, &#39;ID_TO&#39;] representing all references.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Does not consider INSTANCE_ID in reference matching.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; refs = data.references_all()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;VALUE&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_FROM&quot;</span><span class="p">,</span> <span class="s2">&quot;_TO&quot;</span><span class="p">))[[</span><span class="s2">&quot;ID_FROM&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;ID_TO&quot;</span><span class="p">]]</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">references_all</span> <span class="o">=</span> <span class="n">references_all</span>


<div class="viewcode-block" id="references_simple">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.references_simple">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">references_simple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a simplified table view of all references to and from a specified object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    reference : str</span>
<span class="sd">        ID of the object to find references for.</span>
<span class="sd">    columns : list, optional</span>
<span class="sd">        Columns to include in the output table (default is [&#39;Type&#39;, &#39;IdentifiedObject.name&#39;] if available).</span>
<span class="sd">    levels : int, optional</span>
<span class="sd">        Number of reference levels to traverse (default is 1).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Pivoted DataFrame with IDs, specified columns, and reference levels.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; table = data.references_simple(&quot;99722373_VL_TN1&quot;, columns=[&quot;Type&quot;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">references</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">])</span>

    <span class="c1"># Convert form triplets to a table view with columns - ID, Type by default</span>
    <span class="n">data_view</span> <span class="o">=</span> <span class="n">reference_data</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">available_columns</span> <span class="o">=</span> <span class="n">data_view</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">if</span> <span class="s2">&quot;Type&quot;</span> <span class="ow">in</span> <span class="n">available_columns</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;IdentifiedObject.name&quot;</span> <span class="ow">in</span> <span class="n">available_columns</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;IdentifiedObject.name&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_view</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reference_data</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;ID_FROM&quot;</span><span class="p">,</span> <span class="s2">&quot;ID_TO&quot;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">)</span></div>



<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">references_simple</span> <span class="o">=</span> <span class="n">references_simple</span>


<div class="viewcode-block" id="references">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.references">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">references</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve all references (to and from) a specified object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    ID : str</span>
<span class="sd">        ID of the object to find references for.</span>
<span class="sd">    levels : int, optional</span>
<span class="sd">        Number of reference levels to traverse (default is 1).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        DataFrame containing triplets of all references to and from the object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; refs = data.references(&quot;99722373_VL_TN1&quot;, levels=2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FROM</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">references_from</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
    <span class="n">TO</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">references_to</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">FROM</span><span class="p">,</span> <span class="n">TO</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">,</span> <span class="s2">&quot;INSTANCE_ID&quot;</span><span class="p">])</span></div>



<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">references</span> <span class="o">=</span> <span class="n">references</span>


<span class="c1"># def references(data, ID, levels=1):</span>
<span class="c1">#     all_references = data.references_all()</span>
<span class="c1">#     refrences_list = []</span>
<span class="c1">#</span>
<span class="c1">#     references = all_references.query(&quot;ID_FROM == @ID or ID_TO==@ID&quot;).copy()</span>
<span class="c1">#     references[&quot;level&quot;] = 0</span>
<span class="c1">#     refrences_list.append(references)</span>
<span class="c1">#</span>
<span class="c1">#     level = 1</span>
<span class="c1">#</span>
<span class="c1">#     while levels &gt; level:</span>
<span class="c1">#</span>
<span class="c1">#         previous_references = refrences_list[level-1][[&#39;ID_FROM&#39;, &#39;KEY&#39;, &#39;ID_TO&#39;]]</span>
<span class="c1">#</span>
<span class="c1">#         FROM = all_references.merge(previous_references[&quot;ID_FROM&quot;]).drop_duplicates()</span>
<span class="c1">#         TO = all_references.merge(previous_references[&quot;ID_TO&quot;]).drop_duplicates()</span>
<span class="c1">#         FROM_and_TO = pandas.concat([FROM, TO]).drop_duplicates()</span>
<span class="c1">#</span>
<span class="c1">#         new_references = pandas.concat([FROM_and_TO, previous_references]).drop_duplicates(keep=False)</span>
<span class="c1">#         new_references[&quot;level&quot;] = level</span>
<span class="c1">#         refrences_list.append(new_references)</span>
<span class="c1">#</span>
<span class="c1">#         level += 1</span>
<span class="c1">#</span>
<span class="c1">#     return pandas.concat(refrences_list, ignore_index=True)</span>
<span class="c1"># pandas.DataFrame.references = references()</span>


<div class="viewcode-block" id="types_dict">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.types_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">types_dict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a dictionary of object types and their occurrence counts.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary with object types as keys and their counts as values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; types = data.types_dict()</span>
<span class="sd">    &gt;&gt;&gt; print(types)</span>
<span class="sd">    {&#39;ACLineSegment&#39;: 10, &#39;PowerTransformer&#39;: 5, ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types_dictionary</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">KEY</span> <span class="o">==</span> <span class="s2">&quot;Type&quot;</span><span class="p">)][</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">types_dictionary</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">types_dict</span> <span class="o">=</span> <span class="n">types_dict</span>


<div class="viewcode-block" id="set_VALUE_at_KEY">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.set_VALUE_at_KEY">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_VALUE_at_KEY</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the value for all instances of a specified key.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    key : str</span>
<span class="sd">        The key to update.</span>
<span class="sd">    value : str</span>
<span class="sd">        The new value to set for the specified key.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - TODO: Add debug logging for key, initial value, and new value.</span>
<span class="sd">    - TODO: Store changes in a changes DataFrame.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; data.set_VALUE_at_KEY(&quot;label&quot;, &quot;new_label&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">KEY</span> <span class="o">==</span> <span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># TODO add changes to change DataFrame</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">set_VALUE_at_KEY</span> <span class="o">=</span> <span class="n">set_VALUE_at_KEY</span>


<div class="viewcode-block" id="set_VALUE_at_KEY_and_ID">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.set_VALUE_at_KEY_and_ID">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_VALUE_at_KEY_and_ID</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the value for a specific key and ID.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    key : str</span>
<span class="sd">        The key to update.</span>
<span class="sd">    value : str</span>
<span class="sd">        The new value to set.</span>
<span class="sd">    id : str</span>
<span class="sd">        The ID of the object to update.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; data.set_VALUE_at_KEY_and_ID(&quot;label&quot;, &quot;new_label&quot;, &quot;uuid1&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">KEY</span> <span class="o">==</span> <span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">set_VALUE_at_KEY_and_ID</span> <span class="o">=</span> <span class="n">set_VALUE_at_KEY_and_ID</span>

<span class="c1"># TODO - add CSV export</span>
<div class="viewcode-block" id="export_to_excel">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.export_to_excel">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">export_to_excel</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export triplet data to an Excel file, with each type on a separate sheet.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    path : str, optional</span>
<span class="sd">        Directory path to save the Excel file (default is current working directory).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Uses &#39;label&#39; key to determine the filename for each INSTANCE_ID.</span>
<span class="sd">    - Each object type is exported to a separate sheet.</span>
<span class="sd">    - TODO: Add support for XlsxWriter properties for better formatting.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; data.export_to_excel(&quot;output_dir&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO set some nice properties - https://xlsxwriter.readthedocs.io/workbook.html#workbook-set-properties</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;label&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
    <span class="c1"># TODO dont use iterrows</span>
    <span class="c1"># TODO instead of label use Distribution</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">instance_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">INSTANCE_ID</span> <span class="o">==</span> <span class="n">label</span><span class="o">.</span><span class="n">INSTANCE_ID</span><span class="p">]</span>

        <span class="n">types</span> <span class="o">=</span> <span class="n">instance_data</span><span class="o">.</span><span class="n">types_dict</span><span class="p">()</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.xlsx&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exporting excel: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">class_type</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">class_data</span> <span class="o">=</span> <span class="n">instance_data</span><span class="o">.</span><span class="n">type_tableview</span><span class="p">(</span><span class="n">class_type</span><span class="p">)</span>
            <span class="n">class_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">class_type</span><span class="p">)</span>

            <span class="c1"># Get sheet to do some formatting</span>
            <span class="n">sheet</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">class_type</span><span class="p">]</span>

            <span class="c1"># Set default column size, if this does not work you are missing XslxWriter module</span>
            <span class="n">first_col</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">last_col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">38</span>
            <span class="n">sheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">first_col</span><span class="p">,</span> <span class="n">last_col</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

            <span class="c1"># freeze column names and ID column</span>
            <span class="n">sheet</span><span class="o">.</span><span class="n">freeze_panes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">export_to_excel</span> <span class="o">=</span> <span class="n">export_to_excel</span>


<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>  <span class="c1"># Adjust maxsize based on the number of unique QName combinations</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_get_qname</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a QName for a given namespace and tag, with caching.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    namespace : str</span>
<span class="sd">        The namespace URI.</span>
<span class="sd">    tag : str, optional</span>
<span class="sd">        The tag name (default is None).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lxml.etree.QName</span>
<span class="sd">        The qualified name object for the namespace and tag.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; qname = _get_qname(&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;, &quot;RDF&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qname</span> <span class="o">=</span> <span class="n">QName</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
    <span class="c1">#logger.debug(f&quot;Cache info: {get_qname.cache_info()}&quot;)</span>
    <span class="k">return</span> <span class="n">qname</span>



<div class="viewcode-block" id="generate_xml">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.generate_xml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_xml</span><span class="p">(</span><span class="n">instance_data</span><span class="p">,</span>
                 <span class="n">rdf_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">namespace_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">class_KEY</span><span class="o">=</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span>
                 <span class="n">export_undefined</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an RDF XML file from a triplet dataset instance.</span>

<span class="sd">        This function processes a single instance (grouped by ``INSTANCE_ID``) from a triplet</span>
<span class="sd">        dataset and exports it as an RDF/XML document using provided or inferred mapping rules.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instance_data : pandas.DataFrame</span>
<span class="sd">            Triplet dataset for a single instance, with columns [&#39;&#39;ID&#39;, &#39;KEY&#39;, &#39;VALUE&#39;, INSTANCE_ID&#39;].</span>
<span class="sd">            Must contain at least one row with ``KEY == class_KEY`` to define object types.</span>
<span class="sd">        rdf_map : dict or str, optional</span>
<span class="sd">            Dictionary mapping CIM classes and attributes to RDF namespaces and export rules.</span>
<span class="sd">            If a string is provided, it is treated as a file path to a JSON configuration.</span>
<span class="sd">            If ``None``, attempts to infer from instance data (e.g., profile-based mapping).</span>
<span class="sd">        namespace_map : dict, optional</span>
<span class="sd">            Mapping of namespace prefixes to URIs (e.g., ``{&quot;cim&quot;: &quot;http://iec.ch/TC57/2013/CIM-schema-cim16#&quot;}``).</span>
<span class="sd">            Must include ``&quot;rdf&quot;`` namespace. If ``None``, inferred from ``rdf_map`` or instance.</span>
<span class="sd">        class_KEY : str, default &quot;Type&quot;</span>
<span class="sd">            Column key used to identify object class/type in the triplet data.</span>
<span class="sd">        export_undefined : bool, default True</span>
<span class="sd">            If True, export classes and attributes without explicit mapping using default RDF settings.</span>
<span class="sd">            If False, skip unmapped elements with a warning.</span>
<span class="sd">        comment : str, optional</span>
<span class="sd">            Optional comment to insert at the top of the XML output (as XML comment).</span>
<span class="sd">        debug : bool, default False</span>
<span class="sd">            If True, log detailed timing and debug information during processing.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing:</span>
<span class="sd">            - ``&#39;filename&#39;`` (str): Generated filename (from ``label`` or UUID).</span>
<span class="sd">            - ``&#39;file&#39;`` (bytes): UTF-8 encoded XML content.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If required columns are missing in ``instance_data``.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If invalid export configuration or mapping is detected.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; instance = data[data[&quot;INSTANCE_ID&quot;] == 1]</span>
<span class="sd">        &gt;&gt;&gt; result = generate_xml(</span>
<span class="sd">        ...     instance,</span>
<span class="sd">        ...     rdf_map=&quot;config/eq_profile.json&quot;,</span>
<span class="sd">        ...     comment=&quot;Exported on 2025-11-11&quot;,</span>
<span class="sd">        ...     debug=True</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; with open(result[&quot;filename&quot;], &quot;wb&quot;) as f:</span>
<span class="sd">        ...     f.write(result[&quot;file&quot;])</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Supports profile-based mapping (e.g., &quot;EQ&quot;, &quot;SSH&quot;) via ``Model.profile`` or ``Model.messageType``.</span>
<span class="sd">        - Uses ``lxml.etree`` with ``ElementMaker`` for XML construction.</span>
<span class="sd">        - Undefined classes are exported with ``rdf:about=&quot;urn:uuid:&lt;ID&gt;&quot;`` when ``export_undefined=True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="c1"># TODO - Use if logger debug</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># config map, is not given as dict, assume path and load it</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rdf_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rdf_map</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conf_file</span><span class="p">:</span>
            <span class="n">rdf_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

    <span class="c1"># No map in function call, use instance map</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">namespace_map</span><span class="p">:</span>
        <span class="n">namespace_map</span><span class="p">,</span> <span class="n">xml_base</span> <span class="o">=</span> <span class="n">get_namespace_map</span><span class="p">(</span><span class="n">instance_data</span><span class="p">)</span>

    <span class="c1"># Filename is kept under label</span>
    <span class="n">label_data</span> <span class="o">=</span> <span class="n">instance_data</span><span class="p">[</span><span class="n">instance_data</span><span class="p">[</span><span class="s2">&quot;KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">label_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">label_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">label_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;VALUE&#39;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="si">}</span><span class="s2">.xml&quot;</span>

    <span class="c1"># Find schema reference to be used for export</span>
    <span class="c1"># TODO remove dependency on this header field, which might not be present</span>
    <span class="c1"># TODO: Refactor this, if schema is provided, the information how to pick it up should be in the schema</span>

    <span class="n">instance_type</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">message_type_data</span> <span class="o">=</span> <span class="n">instance_data</span><span class="p">[</span><span class="n">instance_data</span><span class="p">[</span><span class="s2">&quot;KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Model.messageType&quot;</span><span class="p">]</span>
    <span class="n">profile_data</span> <span class="o">=</span> <span class="n">instance_data</span><span class="p">[</span><span class="n">instance_data</span><span class="p">[</span><span class="s2">&quot;KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Model.profile&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">message_type_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">instance_type</span> <span class="o">=</span> <span class="n">message_type_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">message_type_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;VALUE&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">instance_type</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">profile_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">instance_type_url</span> <span class="o">=</span> <span class="n">profile_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">profile_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;VALUE&#39;</span><span class="p">]</span>

        <span class="c1"># TODO - needs to be extended and made more intelligent, maybe scan profile?</span>
        <span class="n">profile_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;EquipmentCore&quot;</span><span class="p">:</span> <span class="s2">&quot;EQ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SteadyState&quot;</span><span class="p">:</span> <span class="s2">&quot;SSH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;StateVariables&quot;</span><span class="p">:</span> <span class="s2">&quot;SV&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Topology/&quot;</span><span class="p">:</span> <span class="s2">&quot;TP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EquipmentBoundary&quot;</span><span class="p">:</span> <span class="s2">&quot;EQBD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TopologyBoundary&quot;</span><span class="p">:</span> <span class="s2">&quot;TPBD&quot;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">profile_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">instance_type_url</span><span class="p">:</span>
                <span class="n">instance_type</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">continue</span>

    <span class="c1"># If there is sub structure available in schema get it, otherwise use root definitions</span>
    <span class="c1"># TODO - needs revision, add support both for md:FullModel, dcat:DataSet and without profile definiton</span>
    <span class="n">instance_rdf_map</span> <span class="o">=</span> <span class="n">rdf_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instance_type</span><span class="p">,</span> <span class="n">rdf_map</span><span class="p">)</span>

    <span class="c1"># No map in function call, nor in instance data, use profile map</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">namespace_map</span> <span class="ow">and</span> <span class="n">instance_rdf_map</span><span class="p">:</span>
        <span class="n">namespace_map</span> <span class="o">=</span> <span class="n">instance_rdf_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ProfileNamespaceMap&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">instance_rdf_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No rdf mapping available for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instance_type</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">export_undefined</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;File not created for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
            <span class="k">return</span>

    <span class="c1"># Create element builder</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">ElementMaker</span><span class="p">(</span><span class="n">nsmap</span><span class="o">=</span><span class="n">namespace_map</span><span class="p">)</span>

    <span class="c1"># Create xml root element</span>
    <span class="n">RDF</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">QName</span><span class="p">(</span><span class="n">namespace_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rdf&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span><span class="p">),</span> <span class="s2">&quot;RDF&quot;</span><span class="p">))</span>

    <span class="c1"># Add comment</span>
    <span class="k">if</span> <span class="n">comment</span><span class="p">:</span>
        <span class="n">RDF</span><span class="o">.</span><span class="n">addprevious</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">Comment</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">comment</span><span class="p">)))</span>

    <span class="c1"># Store created xml rdf class elements</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># TODO ensure that the Header class is serialised first</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;File root generated&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="c1"># Generate objects (Class instance)</span>
    <span class="c1"># TODO: Maybe group by class name: less lookups</span>
    <span class="k">for</span> <span class="n">class_data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">instance_data</span><span class="p">[</span><span class="n">instance_data</span><span class="p">[</span><span class="s2">&quot;KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">class_KEY</span><span class="p">])</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>

        <span class="n">ID</span> <span class="o">=</span> <span class="n">class_data</span><span class="o">.</span><span class="n">ID</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_data</span><span class="o">.</span><span class="n">VALUE</span>

        <span class="c1"># Get class export definition</span>
        <span class="n">class_def</span> <span class="o">=</span> <span class="n">instance_rdf_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">class_def</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">class_namespace</span> <span class="o">=</span> <span class="n">class_def</span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
            <span class="n">id_name</span> <span class="o">=</span> <span class="n">class_def</span><span class="p">[</span><span class="s2">&quot;attrib&quot;</span><span class="p">][</span><span class="s2">&quot;attribute&quot;</span><span class="p">]</span>
            <span class="n">id_value_prefix</span> <span class="o">=</span> <span class="n">class_def</span><span class="p">[</span><span class="s2">&quot;attrib&quot;</span><span class="p">][</span><span class="s2">&quot;value_prefix&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Definition missing for class: </span><span class="si">{}</span><span class="s2"> with </span><span class="si">{}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">ID</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">export_undefined</span><span class="p">:</span>
                <span class="n">class_namespace</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">id_name</span> <span class="o">=</span> <span class="s2">&quot;{http://www.w3.org/1999/02/22-rdf-syntax-ns#}about&quot;</span>
                <span class="n">id_value_prefix</span> <span class="o">=</span> <span class="s2">&quot;urn:uuid:&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2"> not Exported&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># Create class element</span>
        <span class="c1"># logger.debug(class_namespace, class_name) # DEBUG</span>
        <span class="n">rdf_object</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">_get_qname</span><span class="p">(</span><span class="n">class_namespace</span><span class="p">,</span> <span class="n">class_name</span><span class="p">))</span>
        <span class="c1"># Add ID attribute</span>
        <span class="n">rdf_object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">_get_qname</span><span class="p">(</span><span class="n">id_name</span><span class="p">)]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">id_value_prefix</span><span class="si">}{</span><span class="n">ID</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Add object to RDF</span>
        <span class="n">RDF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rdf_object</span><span class="p">)</span>
        <span class="c1"># Add object with it&#39;s ID to dict (later we use it to add attributes to that class)</span>
        <span class="n">objects</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdf_object</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;Objects added&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="c1"># Add attribute to objects</span>
    <span class="c1"># TODO - maybe make work que here, all Objects are generated, we now need to just add attributes to them, but we are going object by object</span>
    <span class="c1"># TODO - maybe group by KEY: avoid all prefix building lookups</span>
    <span class="c1"># TODO - maybe filter out all rows without Type before: avoid checking in the loop</span>
    <span class="k">for</span> <span class="n">attribute_data</span> <span class="ow">in</span> <span class="n">instance_data</span><span class="p">[</span><span class="n">instance_data</span><span class="p">[</span><span class="s2">&quot;KEY&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">class_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="c1">#for attribute_data in instance_data[instance_data[&quot;KEY&quot;] != class_KEY].itertuples():</span>

        <span class="n">ID</span> <span class="o">=</span> <span class="n">attribute_data</span><span class="o">.</span><span class="n">ID</span>
        <span class="n">KEY</span> <span class="o">=</span> <span class="n">attribute_data</span><span class="o">.</span><span class="n">KEY</span>
        <span class="n">VALUE</span> <span class="o">=</span> <span class="n">attribute_data</span><span class="o">.</span><span class="n">VALUE</span>

        <span class="n">_object</span> <span class="o">=</span> <span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1">#if not pandas.isna(VALUE):</span>

            <span class="n">tag_def</span> <span class="o">=</span> <span class="n">instance_rdf_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tag_def</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">_get_qname</span><span class="p">(</span><span class="n">tag_def</span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">],</span> <span class="n">KEY</span><span class="p">))</span>
                <span class="n">attrib</span> <span class="o">=</span> <span class="n">tag_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">text_prefix</span> <span class="o">=</span> <span class="n">tag_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">attrib</span><span class="p">:</span>

                    <span class="n">value_prefix</span> <span class="o">=</span> <span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value_prefix&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="c1"># Get namespace for enumerations</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">value_prefix</span><span class="p">:</span>
                        <span class="n">value_prefix</span> <span class="o">=</span> <span class="n">instance_rdf_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">VALUE</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="n">tag</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">_get_qname</span><span class="p">(</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;attribute&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value_prefix</span><span class="si">}{</span><span class="n">VALUE</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text_prefix</span><span class="si">}{</span><span class="n">VALUE</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="n">_object</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Definition missing for tag: &quot;</span> <span class="o">+</span> <span class="n">KEY</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">export_undefined</span><span class="p">:</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">KEY</span><span class="p">)</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">VALUE</span><span class="p">)</span>

                    <span class="n">_object</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>


        <span class="c1">#else:</span>
        <span class="c1">#    logger.debug(&quot;Attribute VALUE is None, thus not exported: ID: {} KEY: {}&quot;.format(ID, KEY))</span>
        <span class="c1">#    pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No Object with ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ID</span><span class="p">))</span>
            <span class="k">pass</span>

    <span class="c1"># etree.tostring(RDF, pretty_print=True, xml_declaration=True, encoding=&#39;UTF-8&#39;)</span>
    <span class="c1"># logger.debug(etree.tostring(RDF, pretty_print=True).decode())</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;Attributes added&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="c1"># Convert to XML</span>
    <span class="n">xml</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">RDF</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
    <span class="c1"># TODO - clean namespaces</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exporting RDF to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;XML created&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">xml</span><span class="p">}</span></div>


<div class="viewcode-block" id="ExportType">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.ExportType">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ExportType</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
    <span class="n">XML_PER_INSTANCE</span> <span class="o">=</span> <span class="s2">&quot;xml_per_instance&quot;</span>
    <span class="n">XML_PER_INSTANCE_ZIP_PER_ALL</span> <span class="o">=</span> <span class="s2">&quot;xml_per_instance_zip_per_all&quot;</span>
    <span class="n">XML_PER_INSTANCE_ZIP_PER_XML</span> <span class="o">=</span> <span class="s2">&quot;xml_per_instance_zip_per_xml&quot;</span></div>



<div class="viewcode-block" id="export_to_cimxml">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.export_to_cimxml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">export_to_cimxml</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                     <span class="n">rdf_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">namespace_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">class_KEY</span><span class="o">=</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span>
                     <span class="n">export_undefined</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">export_type</span><span class="o">=</span><span class="n">ExportType</span><span class="o">.</span><span class="n">XML_PER_INSTANCE_ZIP_PER_XML</span><span class="p">,</span>
                     <span class="n">global_zip_filename</span><span class="o">=</span><span class="s2">&quot;Export.zip&quot;</span><span class="p">,</span>
                     <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">export_to_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">export_base_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                     <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">max_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export a full triplet dataset to CIM RDF XML files or ZIP archives.</span>

<span class="sd">        Processes all instances (grouped by ``INSTANCE_ID``) and exports them according to the</span>
<span class="sd">        specified ``export_type``. Supports parallel processing and in-memory or disk output.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pandas.DataFrame</span>
<span class="sd">            Full triplet dataset with columns [&#39;INSTANCE_ID&#39;, &#39;ID&#39;, &#39;KEY&#39;, &#39;VALUE&#39;].</span>
<span class="sd">        rdf_map : dict or str, optional</span>
<span class="sd">            RDF mapping configuration (see :func:`generate_xml`).</span>
<span class="sd">        namespace_map : dict, optional</span>
<span class="sd">            Namespace prefix-to-URI mapping (see :func:`generate_xml`).</span>
<span class="sd">        class_KEY : str, default &quot;Type&quot;</span>
<span class="sd">            Key identifying object types in triplet data.</span>
<span class="sd">        export_undefined : bool, default True</span>
<span class="sd">            Export unmapped classes/attributes with default RDF syntax.</span>
<span class="sd">        export_type : ExportType or str, default ExportType.XML_PER_INSTANCE_ZIP_PER_XML</span>
<span class="sd">            Export format:</span>
<span class="sd">            - ``XML_PER_INSTANCE``: One XML file per instance.</span>
<span class="sd">            - ``XML_PER_INSTANCE_ZIP_PER_ALL``: All XMLs in a single ZIP.</span>
<span class="sd">            - ``XML_PER_INSTANCE_ZIP_PER_XML``: Each XML in its own ZIP.</span>
<span class="sd">        global_zip_filename : str, default &quot;Export.zip&quot;</span>
<span class="sd">            Filename for the global ZIP archive (used with ``ZIP_PER_ALL``).</span>
<span class="sd">        debug : bool, default False</span>
<span class="sd">            Enable detailed timing and debug logging.</span>
<span class="sd">        export_to_memory : bool, default False</span>
<span class="sd">            If True, return file-like objects (``BytesIO``); if False, save to disk.</span>
<span class="sd">        export_base_path : str, default &quot;&quot;</span>
<span class="sd">            Directory to save files when ``export_to_memory=False``. Uses current directory if empty.</span>
<span class="sd">        comment : str, optional</span>
<span class="sd">            Optional XML comment added to each generated file.</span>
<span class="sd">        max_workers : int, optional</span>
<span class="sd">            Number of parallel workers for XML generation. If ``None``, runs sequentially.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            - If ``export_to_memory=True``: List of ``BytesIO`` objects with ``.name`` attribute.</span>
<span class="sd">            - If ``export_to_memory=False``: List of saved filenames (relative to ``export_base_path``).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; files = export_to_cimxml(</span>
<span class="sd">        ...     data,</span>
<span class="sd">        ...     rdf_map=&quot;config/cim_map.json&quot;,</span>
<span class="sd">        ...     export_type=ExportType.XML_PER_INSTANCE_ZIP_PER_XML,</span>
<span class="sd">        ...     export_to_memory=True,</span>
<span class="sd">        ...     max_workers=4</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; for f in files:</span>
<span class="sd">        ...     print(f&quot;name:&quot;, f.name)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Uses ``concurrent.futures.ProcessPoolExecutor`` for parallel XML generation.</span>
<span class="sd">        - All XML files are UTF-8 encoded with XML declaration and pretty-printing.</span>
<span class="sd">        - ZIP files use DEFLATED compression.</span>
<span class="sd">        - Filenames are derived from instance ``label`` or UUID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">init_time</span> <span class="o">=</span> <span class="n">start_time</span>

    <span class="n">instances</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;INSTANCE_ID&quot;</span><span class="p">)</span>

    <span class="c1">#TODO - this needs to be extended and put to a better place</span>
    <span class="c1">#TODO - maybe rdfmap should use direct url, instead of short keys &quot;EQ&quot; etc</span>

    <span class="c1"># Keep all file names and data to be exported</span>
    <span class="n">xml_documents</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;All file instance ID-s identified&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="c1"># if max_workers:</span>
    <span class="c1">#     with ProcessPoolExecutor(max_workers=max_workers) as executor:</span>
    <span class="c1">#         # Map the function to the XML list and accumulate results</span>
    <span class="c1">#         xml_documents = executor.map(lambda _, instance: generate_xml(   instance,</span>
    <span class="c1">#                                                                          rdf_map,</span>
    <span class="c1">#                                                                          namespace_map,</span>
    <span class="c1">#                                                                          class_KEY,</span>
    <span class="c1">#                                                                          export_undefined,</span>
    <span class="c1">#                                                                          comment,</span>
    <span class="c1">#                                                                          debug), instances)</span>
    <span class="k">if</span> <span class="n">max_workers</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">generate_xml</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">rdf_map</span><span class="p">,</span> <span class="n">namespace_map</span><span class="p">,</span> <span class="n">class_KEY</span><span class="p">,</span> <span class="n">export_undefined</span><span class="p">,</span><span class="n">debug</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">]</span>
            <span class="n">xml_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span> <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">xml_documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generate_xml</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span>
                                             <span class="n">rdf_map</span><span class="p">,</span>
                                             <span class="n">namespace_map</span><span class="p">,</span>
                                             <span class="n">class_KEY</span><span class="p">,</span>
                                             <span class="n">export_undefined</span><span class="p">,</span>
                                             <span class="n">comment</span><span class="p">,</span>
                                             <span class="n">debug</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;All XML created in memory &quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="c1">### Export XML ###</span>
    <span class="n">exported_files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">export_type</span> <span class="o">==</span> <span class="n">ExportType</span><span class="o">.</span><span class="n">XML_PER_INSTANCE</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">xml_documents</span><span class="p">:</span>

            <span class="n">file_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
            <span class="n">file_object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span>

            <span class="n">exported_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_object</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exported </span><span class="si">{</span><span class="n">document</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> to memory&quot;</span><span class="p">)</span>

    <span class="c1">### Export ZIP containing all xml ###</span>
    <span class="k">elif</span> <span class="n">export_type</span> <span class="o">==</span> <span class="n">ExportType</span><span class="o">.</span><span class="n">XML_PER_INSTANCE_ZIP_PER_ALL</span><span class="p">:</span>

        <span class="n">gloabl_zip_fileobject</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">gloabl_zip_fileobject</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">global_zip_filename</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">gloabl_zip_fileobject</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">xml_documents</span><span class="p">:</span>
                <span class="n">zip_file</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="n">document</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Added </span><span class="si">{</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> to ZIP&#39;</span><span class="p">)</span>

        <span class="n">exported_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gloabl_zip_fileobject</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exported ZIP named </span><span class="si">{</span><span class="n">global_zip_filename</span><span class="si">}</span><span class="s1"> to memory&#39;</span><span class="p">)</span>


    <span class="c1">### Export each xml in separate zip ###</span>
    <span class="k">elif</span> <span class="n">export_type</span> <span class="o">==</span> <span class="n">ExportType</span><span class="o">.</span><span class="n">XML_PER_INSTANCE_ZIP_PER_XML</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">xml_documents</span><span class="p">:</span>

            <span class="n">zip_file_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">zip_file_object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;.zip&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.XML&#39;</span><span class="p">,</span> <span class="s1">&#39;.zip&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_file_object</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>
                <span class="n">zip_file</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="n">document</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>

            <span class="n">exported_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zip_file_object</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exported </span><span class="si">{</span><span class="n">zip_file_object</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> to memory&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Not supported option&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Supported options are: xml_per_instance, xml_per_instance_zip_per_all, xml_per_instance_zip_per_xml&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;Files saved in&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="n">_print_duration</span><span class="p">(</span><span class="s2">&quot;Whole Export done in&quot;</span><span class="p">,</span> <span class="n">init_time</span><span class="p">)</span>

    <span class="c1"># Save files to disk</span>
    <span class="k">if</span> <span class="n">export_to_memory</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">exported_files</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">exported_file_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">file_object</span> <span class="ow">in</span> <span class="n">exported_files</span><span class="p">:</span>
            <span class="n">export_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_base_path</span><span class="p">,</span> <span class="n">file_object</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">export_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">export_file_object</span><span class="p">:</span>

                <span class="c1"># Ensure that the read pointer is at the start of the file</span>
                <span class="n">file_object</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">export_file_object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_object</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

            <span class="n">exported_file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_object</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved </span><span class="si">{</span><span class="n">export_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">exported_file_names</span></div>



<span class="c1"># Extend this functionality to pandas DataFrame</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">export_to_cimxml</span> <span class="o">=</span> <span class="n">export_to_cimxml</span>


<div class="viewcode-block" id="get_object_data">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.get_object_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_object_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">object_UUID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve data for a specific object by its UUID.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    object_UUID : str</span>
<span class="sd">        UUID of the object to retrieve.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        Series with keys as index and values for the specified object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; obj_data = data.get_object_data(&quot;uuid1&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;ID == &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">object_UUID</span><span class="p">))</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;KEY&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span></div>



<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">get_object_data</span> <span class="o">=</span> <span class="n">get_object_data</span>


<div class="viewcode-block" id="tableview_to_triplet">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.tableview_to_triplet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tableview_to_triplet</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a table view back to a triplet format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Pivoted DataFrame (table view) to convert.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Triplet DataFrame with columns [&#39;ID&#39;, &#39;KEY&#39;, &#39;VALUE&#39;].</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - TODO: Ensure this is only used on valid table views.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; triplet = tableview_to_triplet(table_view)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO add only when tableveiw is created</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;VALUE&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span></div>



<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">tableview_to_triplet</span> <span class="o">=</span> <span class="n">tableview_to_triplet</span>


<span class="c1"># Let&#39;s add empty dataframe to keep changes</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">changes</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>


<div class="viewcode-block" id="update_triplet_from_triplet">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.update_triplet_from_triplet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_triplet_from_triplet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">update_data</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update or add triplets from another triplet dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Original triplet dataset to update.</span>
<span class="sd">    update_data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing updates or new data.</span>
<span class="sd">    update : bool, optional</span>
<span class="sd">        If True, update existing ID-KEY pairs (default is True).</span>
<span class="sd">    add : bool, optional</span>
<span class="sd">        If True, add new ID-KEY pairs (default is True).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Updated triplet dataset.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - TODO: Add a changes DataFrame to track modifications.</span>
<span class="sd">    - TODO: Support updating ID and KEY fields.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; updated_data = data.update_triplet_from_triplet(update_data)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">write_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">,</span> <span class="s2">&quot;INSTANCE_ID&quot;</span><span class="p">]</span>

    <span class="c1"># Choose what columns to use for final merge</span>
    <span class="n">merge_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;INSTANCE_ID&quot;</span> <span class="ow">in</span> <span class="n">update_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">merge_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;INSTANCE_ID&quot;</span><span class="p">]</span>

    <span class="c1"># First reset index to be sure that data does not have duplicated keys</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Make merge to see what updated data already exists in old and what needs to be added</span>
    <span class="n">changes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="s2">&quot;original_index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">update_data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">merge_columns</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_OLD&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
        <span class="c1"># Filter data that needs to be updated</span>
        <span class="n">data_to_update</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;_merge == &#39;both&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;original_index&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">data_to_update</span><span class="p">[</span><span class="s2">&quot;original_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data_to_update</span><span class="p">[</span><span class="n">write_columns</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
        <span class="c1"># Filter data that needs to be added</span>
        <span class="n">data_to_add</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;_merge == &#39;right_only&#39;&quot;</span><span class="p">)[</span><span class="n">write_columns</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">data_to_add</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>



<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">update_triplet_from_triplet</span> <span class="o">=</span> <span class="n">update_triplet_from_triplet</span>


<div class="viewcode-block" id="update_triplet_from_tableview">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.update_triplet_from_tableview">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_triplet_from_tableview</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tableview</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">instance_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update or add triplets from a table view.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Original triplet dataset to update.</span>
<span class="sd">    tableview : pandas.DataFrame</span>
<span class="sd">        Table view containing updates or new data.</span>
<span class="sd">    update : bool, optional</span>
<span class="sd">        If True, update existing ID-KEY pairs (default is True).</span>
<span class="sd">    add : bool, optional</span>
<span class="sd">        If True, add new ID-KEY pairs (default is True).</span>
<span class="sd">    instance_id : str, optional</span>
<span class="sd">        Instance ID to assign to new triplets (default is None).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Updated triplet dataset.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; updated_data = data.update_triplet_from_tableview(table_view, instance_id=&quot;uuid1&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">update_triplet</span> <span class="o">=</span> <span class="n">tableview</span><span class="o">.</span><span class="n">tableview_to_triplet</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">instance_id</span><span class="p">:</span>
        <span class="n">update_triplet</span><span class="p">[</span><span class="s2">&quot;INSTANCE_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance_id</span>

    <span class="k">return</span> <span class="n">update_triplet_from_triplet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">update_triplet</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">add</span><span class="p">)</span></div>



<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">update_triplet_from_tableview</span> <span class="o">=</span> <span class="n">update_triplet_from_tableview</span>


<div class="viewcode-block" id="remove_triplet_from_triplet">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.remove_triplet_from_triplet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_triplet_from_triplet</span><span class="p">(</span><span class="n">from_triplet</span><span class="p">,</span> <span class="n">what_triplet</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove triplets from one dataset that match another.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    from_triplet : pandas.DataFrame</span>
<span class="sd">        Original triplet dataset.</span>
<span class="sd">    what_triplet : pandas.DataFrame</span>
<span class="sd">        Triplet dataset to remove from the original.</span>
<span class="sd">    columns : list, optional</span>
<span class="sd">        Columns to match for removal (default is [&#39;ID&#39;, &#39;KEY&#39;, &#39;VALUE&#39;]).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Dataset with matching triplets removed.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; result = remove_triplet_from_triplet(data, to_remove)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">from_triplet</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">from_triplet</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">what_triplet</span><span class="p">[</span><span class="n">columns</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)[</span><span class="s2">&quot;index&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>



<div class="viewcode-block" id="filter_by_triplet">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.filter_by_triplet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_by_triplet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filter_triplet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter riplet DataFrame using IDs from another DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing CGMES data.</span>
<span class="sd">    filter_triplet : pandas.DataFrame</span>
<span class="sd">        DataFrame containing atleast colum ID to filter by.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Filtered DataFrame with columns [&#39;ID, &#39;KEY&#39;, &#39;VALUE&#39;, &#39;INSTANCE_ID&#39;].</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; filtered = filter_by_triplet(data, filter_triplet)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">filter_triplet</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span></div>


<span class="n">pandas</span><span class="o">.</span><span class="n">filter_triplet_by_triplet</span> <span class="o">=</span> <span class="n">filter_by_triplet</span>


<div class="viewcode-block" id="filter_by_type">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.filter_by_type">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_by_type</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">type_key</span><span class="o">=</span><span class="s2">&quot;Type&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter triplet dataset by objects of a specific type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>
<span class="sd">    type_name : str</span>
<span class="sd">        Object type to filter by (e.g., &#39;ACLineSegment&#39;).</span>
<span class="sd">    type_key : str</span>
<span class="sd">        Key used in triplet to indicate type, by default &quot;Type&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Filtered triplet dataset containing only objects of the specified type.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; filtered = filter_by_type(data, &quot;ACLineSegment&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filter_triplet</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">KEY</span> <span class="o">==</span> <span class="n">type_key</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">VALUE</span> <span class="o">==</span> <span class="n">type_name</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">filter_by_triplet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filter_triplet</span><span class="p">)</span></div>



<div class="viewcode-block" id="diff_between_triplet">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.diff_between_triplet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">diff_between_triplet</span><span class="p">(</span><span class="n">old_data</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the difference between two Triplet DataFrames.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    old_data : pandas.DataFrame</span>
<span class="sd">        Original triplet dataset.</span>
<span class="sd">    new_data : pandas.DataFrame</span>
<span class="sd">        New triplet dataset to compare against.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        DataFrame containing triplets unique to old_data or new_data, with an &#39;_merge&#39; column</span>
<span class="sd">        indicating &#39;left_only&#39; (in old_data) or &#39;right_only&#39; (in new_data).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; diff = diff_between_triplet(old_data, new_data)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">old_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_OLD&quot;</span><span class="p">,</span> <span class="s2">&quot;_NEW&quot;</span><span class="p">),</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;_merge != &#39;both&#39;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="diff_between_INSTANCE">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.diff_between_INSTANCE">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">diff_between_INSTANCE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">INSTANCE_ID_1</span><span class="p">,</span> <span class="n">INSTANCE_ID_2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Identify differences between two loaded INSTANCES, by thier INSTACE_ID in the same Triplet DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing two or more INSTANCE.</span>
<span class="sd">    INSTANCE_ID_1 : str</span>
<span class="sd">        UUID of the first INSTANCE.</span>
<span class="sd">    INSTANCE_ID_2 : str</span>
<span class="sd">        UUID of the second INSTANCE.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        DataFrame containing triplets that differ between the two model parts.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; diff = diff_between_INSTANCE(&#39;uuid1&#39;, &#39;uuid2&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;INSTANCE_ID == &#39;</span><span class="si">{}</span><span class="s2">&#39; or INSTANCE_ID == &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">INSTANCE_ID_1</span><span class="p">,</span> <span class="n">INSTANCE_ID_2</span><span class="p">))</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">diff</span></div>


<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">diff_between_INSTANCE</span> <span class="o">=</span> <span class="n">diff_between_INSTANCE</span>

<div class="viewcode-block" id="print_triplet_diff">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.print_triplet_diff">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">print_triplet_diff</span><span class="p">(</span><span class="n">old_data</span><span class="p">,</span> <span class="n">new_data</span><span class="p">,</span> <span class="n">file_id_object</span><span class="o">=</span><span class="s2">&quot;Distribution&quot;</span><span class="p">,</span> <span class="n">file_id_key</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">exclude_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print a human-readable diff of two triplet datasets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    old_data : pandas.DataFrame</span>
<span class="sd">        Original triplet dataset.</span>
<span class="sd">    new_data : pandas.DataFrame</span>
<span class="sd">        New triplet dataset to compare against.</span>
<span class="sd">    file_id_object : str, optional</span>
<span class="sd">        Object type containing file identifiers (default is &#39;Distribution&#39;).</span>
<span class="sd">    file_id_key : str, optional</span>
<span class="sd">        Key containing file identifiers (default is &#39;label&#39;).</span>
<span class="sd">    exclude_objects : list, optional</span>
<span class="sd">        List of object types to exclude from the diff (default is None).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Outputs a diff format showing removed, added, and changed objects.</span>
<span class="sd">    - Nice diff viewer https://diffy.org/</span>
<span class="sd">    - TODO: Add name field for better reporting with Type.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; print_triplet_diff(old_data, new_data, exclude_objects=[&quot;NamespaceMap&quot;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get diff between datasets</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">diff_between_triplet</span><span class="p">(</span><span class="n">old_data</span><span class="p">,</span> <span class="n">new_data</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;_merge&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;left_only&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;right_only&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">}})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;KEY&#39;</span><span class="p">])</span>

    <span class="c1"># Extract internal structures keeping file name information</span>
    <span class="n">file_id_data</span> <span class="o">=</span> <span class="n">filter_by_type</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">file_id_object</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">remove_triplet_from_triplet</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">file_id_data</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO - removed </span><span class="si">{</span><span class="n">file_id_object</span><span class="si">}</span><span class="s2"> from diff&quot;</span><span class="p">)</span>

    <span class="c1"># Exclude defined types form export</span>
    <span class="k">if</span> <span class="n">exclude_objects</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">object_name</span> <span class="ow">in</span> <span class="n">exclude_objects</span><span class="p">:</span>
            <span class="n">excluded_data</span> <span class="o">=</span> <span class="n">filter_by_type</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">object_name</span><span class="p">)</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">remove_triplet_from_triplet</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">excluded_data</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO - removed </span><span class="si">{</span><span class="n">object_name</span><span class="si">}</span><span class="s2"> from diff&quot;</span><span class="p">)</span>

    <span class="c1"># Extract types on left and right to get changed/modified types</span>
    <span class="n">removed_added_modified_types</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
        <span class="n">old_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;Type&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;Type&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="p">])[[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="c1"># Print old file name</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">file_id</span> <span class="ow">in</span> <span class="n">old_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KEY == &#39;</span><span class="si">{</span><span class="n">file_id_key</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="c1"># from-file-modification-time&quot;)</span>

    <span class="c1"># Print new file name</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">file_id</span> <span class="ow">in</span> <span class="n">new_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KEY == &#39;</span><span class="si">{</span><span class="n">file_id_key</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;+++ </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="c1"># to-file-modification-time&quot;)</span>

    <span class="c1"># Print changes</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@@ -1,0 +1,0 @@ Removed:&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">diff</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;Type&#39; and _merge == &#39;-&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@@ -1,0 +1,0 @@ Added:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">diff</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;Type&#39; and _merge == &#39;+&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@@ -1,0 +1,0 @@ Changed:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">removed_added_modified_types</span><span class="p">,</span> <span class="n">diff</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;Type&#39;&quot;</span><span class="p">)])[[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1"># Types changed</span>
    <span class="c1"># TODO add name field to be used with Type for better reporting</span>

    <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">removed_added_modified_types</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;VALUE&quot;</span><span class="p">):</span>
        <span class="c1">#print(f&quot;Types - {group_name}&quot;)</span>
        <span class="k">for</span> <span class="n">objec_type</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>

            <span class="n">current_diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;ID == @objec_type.ID&quot;</span><span class="p">)</span>

            <span class="n">changes_on_left</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_diff</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;_merge == &#39;-&#39;&quot;</span><span class="p">))</span>
            <span class="n">changes_on_right</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_diff</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;_merge == &#39;+&#39;&quot;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@@ -1,</span><span class="si">{</span><span class="n">changes_on_left</span><span class="si">}</span><span class="s2"> +1,</span><span class="si">{</span><span class="n">changes_on_right</span><span class="si">}</span><span class="s2"> @@ </span><span class="si">{</span><span class="n">objec_type</span><span class="o">.</span><span class="n">VALUE</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">objec_type</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">change</span> <span class="ow">in</span> <span class="p">(</span><span class="n">current_diff</span><span class="o">.</span><span class="n">_merge</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="n">current_diff</span><span class="o">.</span><span class="n">KEY</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="n">current_diff</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">change</span><span class="p">)</span></div>


    <span class="c1"># Nice diff viewer https://diffy.org/</span>

<span class="c1"># changes = changes.replace({&#39;_merge&#39;: {&quot;left_only&quot;: &quot;-&quot;, &quot;right_only&quot;: &quot;+&quot;}})</span>


<div class="viewcode-block" id="export_to_networkx">
<a class="viewcode-back" href="../../triplets.rdf_parser.html#triplets.rdf_parser.export_to_networkx">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">export_to_networkx</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a triplet dataset to a NetworkX graph.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        Triplet dataset containing RDF data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    networkx.Graph</span>
<span class="sd">        A NetworkX graph with nodes (IDs with Type attributes) and edges (references).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - TODO: Add all node data and support additional graph export formats.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; graph = data.to_networkx()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span>

    <span class="c1">#  TODO - Add all node data</span>
    <span class="c1">#  TODO - Add all supported graph export formats</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">references_all</span><span class="p">()</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;Type&#39;&quot;</span><span class="p">)[[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">]]</span>

    <span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>

    <span class="n">graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">([(</span><span class="n">ID</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">VALUE</span><span class="p">})</span> <span class="k">for</span> <span class="n">ID</span><span class="p">,</span> <span class="n">VALUE</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="n">FROM</span><span class="p">,</span> <span class="n">TO</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">KEY</span><span class="p">})</span> <span class="k">for</span> <span class="n">FROM</span><span class="p">,</span> <span class="n">KEY</span><span class="p">,</span> <span class="n">TO</span> <span class="ow">in</span> <span class="n">edges</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">graph</span></div>



<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">to_networkx</span> <span class="o">=</span> <span class="n">export_to_networkx</span>


<span class="c1"># END OF FUNCTIONS</span>


<span class="c1"># TEST AND EXAMPLES</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(levelname) -10s</span><span class="s1"> </span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(name) -30s</span><span class="s1"> </span><span class="si">%(funcName) -35s</span><span class="s1"> </span><span class="si">%(lineno) -5d</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;../test_data/TestConfigurations_packageCASv2.0/RealGrid/CGMES_v2.4.15_RealGridTestConfiguration_v2.zip&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_RDF</span><span class="p">([</span><span class="n">path</span><span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#data_arrow = pandas.read_RDF([path], debug=True, data_type=&#39;string[pyarrow]&#39;, max_workers=4)</span>

    <span class="c1"># Performance loading TestConfigurations_packageCASv2.0/RealGrid/CGMES_v2.4.15_RealGridTestConfiguration_v2.zip</span>
    <span class="c1"># 1146191 entries</span>
    <span class="c1"># Last took 0:00:07.919968 on python 3.7  and pandas 1.3.5</span>
    <span class="c1"># Last took 0:00:04.312218 on python 3.11 and pandas 2.0.2</span>
    <span class="c1"># Last took 0:00:01.791312 on python 3.12 and pandas 2.2.3 used 311.6 MB memory and 114.8 MB with arrow backend</span>
    <span class="c1"># Last took 0:00:01.486290 on python 3.12 and pandas 2.2.3 [workers=4] used 311.6 MB memory and 114.8 MB with arrow backend</span>

    <span class="c1">#data = data.convert_dtypes(dtype_backend=&#39;pyarrow&#39;)</span>

    <span class="c1">#data_arrow = data.convert_dtypes(dtype_backend=&#39;pyarrow&#39;)</span>
    <span class="c1">#arrow_memory = data_arrow.memory_usage(deep=True).sum() / 1024**2</span>
    <span class="c1">#pandas_memory = data.memory_usage(deep=True).sum() / 1024**2</span>
    <span class="c1">#print(f&quot;p: {pandas_memory}; a: {arrow_memory}; diff {pandas_memory - arrow_memory}&quot;)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded types&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;KEY == &#39;Type&#39;&quot;</span><span class="p">)[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Example how to get table view of all objects of specified type&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">type_tableview</span><span class="p">(</span><span class="s2">&quot;ACLineSegment&quot;</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Example how to get objects referring to specified object&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">references_to_simple</span><span class="p">(</span><span class="s2">&quot;99722373_VL_TN1&quot;</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Example how to get objects that specified object refers to&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">references_from_simple</span><span class="p">(</span><span class="s2">&quot;99722373_VL_TN1&quot;</span><span class="p">))</span>

    <span class="c1"># model = &quot;FlowExample.zip&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># rdfs = &quot;C:\Users\kristjan.vilgo\Downloads\ENTSOE_CGMES_v2.4.15_04Jul2016_RDFS\EquipmentProfileCoreOperationRDFSAugmented-v2_4_15-4Jul2016.rdf&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># data = load_all_to_dataframe([model, rdfs])</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># values_in_linesegment = data.query(&quot;VALUE == &#39;#ACLineSegment&#39;&quot;)</span>
    <span class="c1"># values_in_powertransform_end = data.query(&quot;VALUE == &#39;#PowerTransformerEnd&#39;&quot;)</span>
    <span class="c1"># data.query(&quot;ID == &#39;#PowerTransformerEnd.r&#39;&quot;)</span>
    <span class="c1"># data.query(&quot;ID == &#39;#Resistance&#39;&quot;)</span>
    <span class="c1">#</span>
    <span class="c1"># data_types = data.query(&quot;KEY == &#39;dataType&#39;&quot;)[&quot;VALUE&quot;].drop_duplicates()</span>

    <span class="c1"># for quick export of data use data[data.VALUE == &quot;PowerTransformer&quot;].to_csv(export.csv) or data[data.VALUE == &quot;PowerTransformer&quot;].to_clipboard() and  paste to excel, for other method refer to pandas manual</span>


    <span class="c1"># SvPowerFlow = data.type_tableview(&quot;SvPowerFlow&quot;).reset_index()</span>
    <span class="c1"># TieFlow = data.type_tableview(&#39;TieFlow&#39;).reset_index()</span>
    <span class="c1"># tieflow_data = TieFlow.merge(SvPowerFlow, right_on=&#39;SvPowerFlow.Terminal&#39;, left_on=&quot;TieFlow.Terminal&quot;, how=&quot;left&quot;, suffixes=(&quot;&quot;, &quot;_SvPowerFlow&quot;))</span>
    <span class="c1">#</span>
    <span class="c1"># print(f&quot;&quot;&quot;</span>
    <span class="c1"># NP (tieflow):   {tieflow_data[&quot;SvPowerFlow.p&quot;].sum()} MW</span>
    <span class="c1"># NP (CA.nI)  :   {data.type_tableview(&quot;ControlArea&quot;).iloc[0][&quot;ControlArea.netInterchange&quot;]} MW</span>
    <span class="c1"># &quot;&quot;&quot;)</span>

    <span class="c1">#Export Config</span>


    <span class="c1">#xml_per_instance, xml_per_instance_zip_per_all, xml_per_instance_zip_per_xml</span>

    <span class="n">export_type</span> <span class="o">=</span> <span class="s2">&quot;xml_per_instance_zip_per_xml&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">triplets.export_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">schemas</span>

    <span class="c1">#Export triplet to CGMES</span>
    <span class="n">data</span><span class="o">.</span><span class="n">export_to_cimxml</span><span class="p">(</span><span class="n">rdf_map</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">ENTSOE_CGMES_2_4_15_552_ED1</span><span class="p">,</span>
                         <span class="n">namespace_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">export_undefined</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">export_type</span><span class="o">=</span><span class="n">ExportType</span><span class="o">.</span><span class="n">XML_PER_INSTANCE_ZIP_PER_XML</span><span class="p">,</span>
                         <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">export_to_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">max_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">cProfile</span>

    <span class="n">profiler</span> <span class="o">=</span> <span class="n">cProfile</span><span class="o">.</span><span class="n">Profile</span><span class="p">()</span>
    <span class="n">profiler</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_RDF</span><span class="p">([</span><span class="n">path</span><span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">profiler</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
    <span class="n">profiler</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="s2">&quot;cumulative&quot;</span><span class="p">)</span>

<span class="c1"># Last took 0:00:21.367552 on python 3.12 and pandas 2.2.3</span>
<span class="c1">#0:00:18.645366</span>
<span class="c1">#0:00:17.975319 [export_to_memory=True</span>
<span class="c1">#0:00:13.102329</span>
<span class="c1">#0:00:14.070468</span>
<span class="c1">#0:00:10.324683</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Kristjan Vilgo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>